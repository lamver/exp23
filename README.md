# Referral Tree

## Консольное приложение на базе Yii2

## Как установить

```
git clone https://github.com/lamver/exp23.git
```

```
composer update
```

#### Прописать данные подключения к базе данных

```
config/db.php
```

## Как пользоваться 
### Команды:

#### referral/build-tree
Построить дерево рефералов на основе поля partner_id таблицы Users:
(-uid - обязательный параметр) Пример:

```
php yii referral/build-tree -uid=82824897
```

#### Результат

```
 ├── 82824897
           ├── 65176747
           ├──    ├── 67153006
           ├──    ├──    ├── 82013161
           ├──    ├──    ├──    ├── 26538759
           ├──    ├──    ├── 55921886
           ├──    ├──    ├── 71042181
           ├──    ├──    ├── 17449681
           ├──    ├──    ├── 27996107
           ├──    ├──    ├── 67615622
           ├──    ├──    ├── 84523912
           ├──    ├──    ├── 86617464
           ├──    ├──    ├── 62983476
           ├──    ├──    ├── 61269594
           ├──    ├──    ├── 60208441
           ├──    ├── 49354192
           ├──    ├──    ├── 58179162
           ├──    ├──    ├── 53516615
............................................
```


#### referral/total-volume
Посчитать суммарный объем volume * coeff_h * coeff_cr по всем уровням реферальной системы за период времени:
(-uid - обязательный параметр, -date_from и -date_to не обязательные параметры) Пример:

```
php yii referral/total-volume -uid=82824897 -date_from=2018-01-01_16:12:10 -date_to=2019-01-01_17:00
```

#### Результат 
```

     Суммарный объем:  2,205.7562

     Полное значение:  2205.756225419274

```

#### referral/total-profit
Посчитать прибыльность (сумма profit) за определенный период времени:
(-uid - обязательный параметр, -date_from и -date_to не обязательные параметры) Пример:

```
php yii referral/total-profit -uid=82824897 -date_from=2018-01-01_16:12:10 -date_to=2019-01-01_17:00
```

#### Результат 
```

     Прибыльность:  164,468.7602

     Полное значение:  164468.76021897793

```

#### referral/count-referral
Посчитать количество прямых рефералов и количество всех рефералов клиента:
(-uid - обязательный параметр, -refdir не обязательный параметр, если не указан (любое значение), то посчитает всех рефералов клиента) Пример:

```
php yii referral/count-referral -uid=82824897 -refdir=1
```

#### Результат 
```

      Всего прямых рефералов: 14

```
##### если без параметра -refdir
```

      Всего всех рефералов: 300

```

 
 
#### referral/count-level
Посчитать количество уровней реферальной сетки:
(-uid - обязательный параметр) Пример:

```
php yii referral/count-level -uid=82824897
```

#### Результат 
```

      Всего уровней реферальной сетки: 4

```